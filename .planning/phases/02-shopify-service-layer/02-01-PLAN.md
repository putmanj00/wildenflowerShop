---
phase: 02-shopify-service-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .env.local
  - app.json
  - types/shopify.ts
autonomous: true
requirements:
  - SHOP-01
  - SHOP-02

must_haves:
  truths:
    - "EXPO_PUBLIC_SHOPIFY_STORE_DOMAIN and EXPO_PUBLIC_SHOPIFY_STOREFRONT_ACCESS_TOKEN are defined in .env.local and readable via process.env static dot notation in app code"
    - "app.json contains no credential leakage — credentials stay in .env.local, not extra config"
    - "types/shopify.ts exports ShopifyProduct, ShopifyCart, ShopifyCollection, ShopifyCartLine, ShopifyProductVariant, ShopifyImage, ShopifyMoneyV2, ShopifyPageInfo, ShopifyPaginatedResult, and ShopifyCollectionWithProducts without TypeScript errors"
    - "Any file in the app can import Shopify types from types/shopify.ts without using any casts"
  artifacts:
    - path: ".env.local"
      provides: "Shopify Storefront credentials for local dev (gitignored)"
    - path: "app.json"
      provides: "Expo app config — no extra field needed; credentials read from EXPO_PUBLIC_ env vars directly"
    - path: "types/shopify.ts"
      provides: "Raw Shopify API type definitions"
      exports:
        - ShopifyMoneyV2
        - ShopifyImage
        - ShopifySelectedOption
        - ShopifyProductVariant
        - ShopifyProduct
        - ShopifyCollection
        - ShopifyCollectionWithProducts
        - ShopifyPageInfo
        - ShopifyCartLine
        - ShopifyCart
        - ShopifyPaginatedResult
  key_links:
    - from: "lib/shopify-client.ts (Plan 02)"
      to: "types/shopify.ts"
      via: "import of ShopifyProduct, ShopifyCollection, etc."
      pattern: "import.*from.*types/shopify"
    - from: "lib/shopify-mappers.ts (Plan 02)"
      to: "types/shopify.ts"
      via: "import of raw types used as function parameters"
      pattern: "import.*ShopifyProduct.*from.*types/shopify"
---

<objective>
Wire Shopify Storefront API credentials into the Expo environment and define all TypeScript types for the Shopify API surface.

Purpose: Plans 02 and 03 depend entirely on these types — client, mappers, and smoke test all import from types/shopify.ts. Environment variables must exist before any service call can be tested. Creating these in Wave 1 unblocks parallel and sequential implementation.

Output: .env.local with credential placeholders, app.json validated (no extra field needed), types/shopify.ts with all Shopify raw API type definitions.
</objective>

<execution_context>
@/Users/jamesputman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jamesputman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-shopify-service-layer/02-CONTEXT.md
@.planning/phases/02-shopify-service-layer/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create .env.local with EXPO_PUBLIC_ credential placeholders</name>
  <files>.env.local</files>
  <action>
Create `.env.local` in the project root. This file is already gitignored by Expo's default .gitignore (`.env*.local`). The file serves as the credential template that the developer populates with real values from the Shopify Partner Dashboard.

File contents:
```
# Shopify Storefront API credentials
# Get these from Shopify Admin → Apps and sales channels → Develop apps → [Your app] → API credentials
# The Storefront access token (public token) is safe to include in mobile app bundles.
EXPO_PUBLIC_SHOPIFY_STORE_DOMAIN=your-store.myshopify.com
EXPO_PUBLIC_SHOPIFY_STOREFRONT_ACCESS_TOKEN=your-public-storefront-access-token
```

IMPORTANT: Use the EXPO_PUBLIC_ prefix — Expo's Metro bundler inlines these at bundle time using static dot notation (process.env.EXPO_PUBLIC_SHOPIFY_STORE_DOMAIN). Do NOT use Constants.expoConfig.extra — that requires expo-constants and loses TypeScript typing. The EXPO_PUBLIC_ approach is the Expo SDK 49+ standard.

Also verify .gitignore has an entry that covers .env.local. Run: grep -n "env" .gitignore
If .gitignore does not exist or does not cover .env.local, add `.env*.local` to .gitignore.

Do NOT modify app.json to add an `extra` field — the EXPO_PUBLIC_ + process.env pattern makes that unnecessary.
  </action>
  <verify>
- File exists: `ls -la .env.local`
- Contains both EXPO_PUBLIC_ keys: `grep "EXPO_PUBLIC_SHOPIFY" .env.local`
- .gitignore covers it: `git status --short .env.local` should show `!!` (ignored) or be absent from untracked
  </verify>
  <done>.env.local exists with both EXPO_PUBLIC_SHOPIFY_STORE_DOMAIN and EXPO_PUBLIC_SHOPIFY_STOREFRONT_ACCESS_TOKEN placeholder values; file is gitignored.</done>
</task>

<task type="auto">
  <name>Task 2: Create types/shopify.ts with all Shopify raw API type definitions</name>
  <files>types/shopify.ts</files>
  <action>
Create `types/shopify.ts` as a NEW file alongside the existing `types/index.ts`. Do NOT modify `types/index.ts` — it contains app-domain types (Product, CartItem, Maker, etc.) that are separate from the raw Shopify API shapes.

The file must export ALL of the following types exactly as defined (raw Shopify API shapes, not transformed app types):

```typescript
// types/shopify.ts
// Raw Shopify Storefront API type definitions (2026-01)
// These mirror the GraphQL API response shapes before transformation.
// Transformed/app-facing types are defined in lib/shopify-mappers.ts as needed.

export interface ShopifyMoneyV2 {
  amount: string;       // decimal string, e.g. "38.00"
  currencyCode: string; // e.g. "USD"
}

export interface ShopifyImage {
  url: string;
  altText: string | null;
  width: number | null;
  height: number | null;
}

export interface ShopifySelectedOption {
  name: string;
  value: string;
}

export interface ShopifyProductVariant {
  id: string;
  title: string;
  availableForSale: boolean;
  price: ShopifyMoneyV2;
  compareAtPrice: ShopifyMoneyV2 | null;
  selectedOptions: ShopifySelectedOption[];
  image: ShopifyImage | null;
}

export interface ShopifyProduct {
  id: string;
  title: string;
  handle: string;
  description: string;
  descriptionHtml?: string;
  vendor: string;
  productType: string;
  tags: string[];
  availableForSale: boolean;
  featuredImage: ShopifyImage | null;
  images: { nodes: ShopifyImage[] };
  priceRange: {
    minVariantPrice: ShopifyMoneyV2;
    maxVariantPrice: ShopifyMoneyV2;
  };
  variants: { nodes: ShopifyProductVariant[] };
}

export interface ShopifyCollection {
  id: string;
  title: string;
  handle: string;
  description: string;
  image: ShopifyImage | null;
}

export interface ShopifyCollectionWithProducts extends ShopifyCollection {
  products: {
    nodes: ShopifyProduct[];
    pageInfo: ShopifyPageInfo;
  };
}

export interface ShopifyPageInfo {
  hasNextPage: boolean;
  endCursor: string | null;
}

export interface ShopifyCartLine {
  id: string;
  quantity: number;
  merchandise: {
    id: string;
    title: string;
    price: ShopifyMoneyV2;
    product: {
      id: string;
      title: string;
      handle: string;
      featuredImage: ShopifyImage | null;
    };
    selectedOptions: ShopifySelectedOption[];
  };
  cost: {
    totalAmount: ShopifyMoneyV2;
  };
}

export interface ShopifyCart {
  id: string;
  checkoutUrl: string;
  totalQuantity: number;
  lines: { nodes: ShopifyCartLine[] };
  cost: {
    subtotalAmount: ShopifyMoneyV2;
    totalAmount: ShopifyMoneyV2;
    totalTaxAmount: ShopifyMoneyV2 | null;
  };
}

// Generic paginated result wrapper returned by service functions
export interface ShopifyPaginatedResult<T> {
  items: T[];
  pageInfo: ShopifyPageInfo;
}
```

Note: ShopifyCart fields (subtotalAmount, totalTaxAmount) are our best inference from Shopify API patterns — Phase 3 will validate exact field names against actual cart mutation responses. Define them as-is; they are correct for the majority case.

After writing the file, run the TypeScript compiler to verify no type errors:
`npx tsc --noEmit --project tsconfig.json 2>&1 | head -30`

If there are errors in types/shopify.ts, fix them before completing this task.
  </action>
  <verify>
- File exists: `ls types/shopify.ts`
- TypeScript compiles: `npx tsc --noEmit 2>&1 | grep "shopify.ts"` — must return no errors
- All required exports present: `grep "^export interface" types/shopify.ts` — must show all 11 interfaces
  </verify>
  <done>types/shopify.ts exists, exports all 11 Shopify raw API type interfaces, compiles without TypeScript errors, and can be imported from any file in the project.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `ls -la .env.local` — file exists with EXPO_PUBLIC_ keys
2. `npx tsc --noEmit 2>&1` — zero TypeScript errors across entire project
3. `grep "^export interface Shopify" types/shopify.ts | wc -l` — at least 10 interfaces exported
4. `git status --short .env.local` — shows `!!` (gitignored) or not listed as untracked
</verification>

<success_criteria>
- .env.local created with both Shopify credential placeholder variables using EXPO_PUBLIC_ prefix
- types/shopify.ts created with ShopifyProduct, ShopifyCart, ShopifyCollection, ShopifyCartLine, ShopifyProductVariant, ShopifyImage, ShopifyMoneyV2, ShopifyPageInfo, ShopifyPaginatedResult, ShopifyCollectionWithProducts, ShopifySelectedOption
- Project TypeScript compilation passes with zero errors
- .env.local is gitignored (credentials never committed)
</success_criteria>

<output>
After completion, create `.planning/phases/02-shopify-service-layer/02-01-SUMMARY.md`
</output>
