---
phase: 10
plan: 1
wave: 1
---

# Plan 10.1: Authentication Storage & Service Layer

## Objective
Establish secure token storage and extend the Shopify service layer with customer mutations, providing the foundation for user authentication.

## Context
- .planning/PROJECT.md
- .planning/REQUIREMENTS.md
- lib/shopify-client.ts
- lib/shopify-queries.ts
- package.json

## Tasks

<task type="auto">
  <name>Install secure storage</name>
  <files>package.json</files>
  <action>
    - Run `npx expo install expo-secure-store`
  </action>
  <verify>grep "expo-secure-store" package.json</verify>
  <done>package.json includes expo-secure-store</done>
</task>

<task type="auto">
  <name>Create Auth Storage Utility</name>
  <files>lib/auth-storage.ts</files>
  <action>
    - Create `lib/auth-storage.ts`.
    - Export `setToken`, `getToken`, and `removeToken` asynchronous functions.
    - Use `Platform.OS === 'web' ? AsyncStorage : SecureStore`.
  </action>
  <verify>ls lib/auth-storage.ts</verify>
  <done>Auth storage utility correctly abstracts storage by platform.</done>
</task>

<task type="auto">
  <name>Extend Shopify Queries & Client</name>
  <files>
    - lib/shopify-queries.ts
    - lib/shopify-client.ts
  </files>
  <action>
    - Add `CUSTOMER_CREATE_MUTATION`, `CUSTOMER_ACCESS_TOKEN_CREATE_MUTATION`, `GET_CUSTOMER_QUERY` to `shopify-queries.ts`.
    - Export `customerCreate`, `customerLogin`, `getCustomer` functions from `shopify-client.ts`.
  </action>
  <verify>grep "customerCreate" lib/shopify-client.ts</verify>
  <done>Shopify client can create customers, generate tokens, and fetch customer queries.</done>
</task>

## Success Criteria
- [ ] `expo-secure-store` is installed.
- [ ] `lib/auth-storage.ts` provides platform-aware token storage.
- [ ] `lib/shopify-client.ts` exposes customer authentication and querying functions.
